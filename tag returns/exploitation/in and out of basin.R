#--------------------------------------------------------------
#Ben Neely
#11/27/2023
#Estimate catch and exploitation of entrained and migratory fish
#--------------------------------------------------------------

## Clear R
cat("\014")  
rm(list=ls())

## Install and load packages
## Checks if package is installed, installs if not, activates for current session
if("FSA" %in% rownames(installed.packages()) == FALSE) {install.packages("FSA")}
library(FSA)

if("rio" %in% rownames(installed.packages()) == FALSE) {install.packages("rio")}
library(rio)

if("patchwork" %in% rownames(installed.packages()) == FALSE) {install.packages("patchwork")}
library(patchwork)

if("tidyverse" %in% rownames(installed.packages()) == FALSE) {install.packages("tidyverse")}
library(tidyverse)

## Set ggplot theme
pubtheme=theme_classic()+
  theme(panel.grid=element_blank(), 
        panel.background=element_blank(),
        plot.background=element_blank(),
        panel.border=element_rect(fill="transparent"),
        axis.title=element_text(size=18,color="black",face="bold"),
        axis.text=element_text(size=14,color="black"),
        legend.position=c(0.999,0.999),
        legend.justification=c("right","top"),
        legend.title=element_blank(),
        legend.text=element_text(size=12),
        legend.background=element_blank(),
        plot.margin=margin(0,0,0,0,"pt"))
options(scipen=999)

## Set working directory
setwd("C:/Users/Ben.Neely/OneDrive - State of Kansas, OITS/Desktop/BCF pop character paper/tag returns/exploitation")

## Read in data with import
dat=import("one_year_return_exp.csv")%>%
  rename(impd=impd.tagged)%>%
  filter(tl>=300)

################################################################################
################################################################################
## Show proportion out-of-basin fish that were harvested
dat1=xtabs(~inbasin+hr+impd,dat)%>%
  as_tibble()%>%
  group_by(impd)%>%
  mutate(tot=sum(n))%>%
  ungroup%>%
  group_by(impd,hr)%>%
  mutate(hr_tot=sum(n))%>%
  ungroup()%>%
  mutate(prop=n/tot,
         hr_prop=n/hr_tot)%>%
  filter(impd=="MILR" | impd=="TCRR")

dat2=xtabs(~impd+hr+inbasin,dat)


